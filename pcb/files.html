<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home page</title>

</head>
<body>    
<h2><a href = "index.html">home</a></h2>


<h1>Files</h1>

<textarea id = "csvtext" style = "width:80%;display:block;height:40em;background-color:black;font:courier;color:#00ff00"></textarea>


<ul id = "filelist">
    
</ul>

<script>

repobase = "https://github.com/lafefspietz/MEMSduino/raw/refs/heads/main/pcb/";

filetypes = {
    "xlsx":"Bill of Materials(Excel file)",
    "zip":"ZIP of Gerber Files used to manufacture board",
    "PcbDoc":"Altium layout file",
    "PrjPcb":"Altium project file",
    "PrjPcbStructure":"Altium project structure file",
    "SchDoc":"Altium schematic file"
}



filenames = [];
var httpcfiles = new XMLHttpRequest();
httpcfiles.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        filenames = JSON.parse(this.responseText);
        loadfiles();
    }
};
httpcfiles.open("GET", "dir.php", true);
httpcfiles.send();

csvdata = "file name, file type, file url\n";

function loadfiles(){
    for(var index = 0;index < filenames.length;index++){
//        var newli = document.createElement("li");
  //      newli.innerHTML = filenames[index]
    //    document.getElementById("filelist").appendChild(newli);
        if(filenames[index].includes(".")){
            extension = filenames[index].split(".")[filenames[index].split(".").length-1]
            if(filetypes[extension] != undefined){
                csvdata += filenames[index] + ",";
                type = "";
                type  = filetypes[extension];   
                csvdata += type + ",";
                csvdata += repobase + filenames[index] + "\n";
            }

        }    
    }
    document.getElementById("csvtext").value = csvdata;   

    data = encodeURIComponent(csvdata);
    var httpc = new XMLHttpRequest();
    var url = "filesaver.php";        
    httpc.open("POST", url, true);
    httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=utf-8");
    httpc.send("data="+data+"&filename=files.csv");//send text to filesaver.php
}

</script>
<style>
    body{
        font-size:2em;
        font-family:Arial;
    }
    a{
        color:#0000ff;
    }
</style>
</body>
</html>
